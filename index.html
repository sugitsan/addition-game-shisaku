<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>たしざんクイズ</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 30px;
    }
    #question {
      font-size: 60px;
      margin: 20px;
    }
    #dots {
      font-size: 40px;
      margin: 10px;
      text-align: left;
      white-space: pre-wrap;
    }
    .btn {
      font-size: 40px;
      padding: 20px;
      margin: 10px;
      background-color: white;
      border: 2px solid #ccc;
      cursor: pointer;
      width: 150px;
    }
    .correct {
      background-color: #a8e6a3 !important;
    }
    .incorrect {
      background-color: #f8c8dc !important;
    }
    #result, #feedback, #timer {
      font-size: 30px;
      margin-top: 20px;
    }
    progress {
      width: 100%;
      height: 30px;
    }
  </style>
</head>
<body>
  <h1>たしざんクイズ</h1>
  <progress id="progressBar" value="0" max="100"></progress>
  <div id="question"></div>
  <div id="dots"></div>
  <div id="buttons"></div>
  <div id="feedback"></div>
  <div id="result"></div>
  <div id="timer"></div>

  <script>
    let currentQuestion = 0;
    let correctCount = 0;
    const totalQuestions = 10;
    let startTime = Date.now();

    function playCorrectSound() {
      const sound = new Audio("correct.mp3");
      sound.play();
    }

    function generateQuestion() {
      document.getElementById("feedback").textContent = "";
      const a = Math.floor(Math.random() * 9) + 1;
      const b = Math.floor(Math.random() * 9) + 1;
      const answer = a + b;

      const question = `${a} ＋ ${b} ＝ ？`;
      document.getElementById("question").textContent = question;

      // ●の表示（左に数字＋5個ごとにスペース）
      const dotCount = answer;
      let dotString = `${dotCount}：`;
      for (let i = 1; i <= dotCount; i++) {
        dotString += "●";
        if (i % 5 === 0 && i !== dotCount) dotString += " ";
      }
      document.getElementById("dots").textContent = dotString;

      // 選択肢の生成（正解を含めたランダムな4択）
      const choices = new Set();
      choices.add(answer);
      while (choices.size < 4) {
        const n = answer + Math.floor(Math.random() * 7) - 3;
        if (n > 0) choices.add(n);
      }

      const buttonsDiv = document.getElementById("buttons");
      buttonsDiv.innerHTML = "";

      Array.from(choices)
        .sort(() => Math.random() - 0.5)
        .forEach(choice => {
          const btn = document.createElement("button");
          btn.textContent = choice;
          btn.className = "btn";
          btn.onclick = () => handleAnswer(choice, answer, btn);
          buttonsDiv.appendChild(btn);
        });

      updateProgress();
    }

    function handleAnswer(choice, answer, button) {
      const buttons = document.querySelectorAll(".btn");
      buttons.forEach(btn => btn.disabled = true);

      if (choice === answer) {
        correctCount++;
        button.classList.add("correct");
        document.getElementById("feedback").textContent = "せいかい！";
        playCorrectSound();
        setTimeout(nextQuestion, 500);
      } else {
        button.classList.add("incorrect");
        document.getElementById("feedback").textContent = `ざんねん、せいかいは ${answer} です。`;
        buttons.forEach(btn => {
          if (parseInt(btn.textContent) === answer) {
            btn.classList.add("correct");
          }
        });
        setTimeout(nextQuestion, 3000);
      }
    }

    function updateProgress() {
      const progressBar = document.getElementById("progressBar");
      progressBar.value = (currentQuestion / totalQuestions) * 100;
    }

    function nextQuestion() {
      currentQuestion++;
      if (currentQuestion < totalQuestions) {
        generateQuestion();
      } else {
        showResult();
      }
    }

    function showResult() {
      document.getElementById("question").textContent = "";
      document.getElementById("dots").textContent = "";
      document.getElementById("buttons").innerHTML = "";
      document.getElementById("feedback").textContent = "";

      let message = "";
      if (correctCount <= 5) {
        message = "つぎも　がんばろう！";
      } else if (correctCount <= 8) {
        message = "なかなか　やりますね！";
      } else if (correctCount === 9) {
        message = "おしい、あと１もんでパーフェクト！";
      } else {
        message = "すばらしい！かんぺきです！！";
      }

      const timeTaken = Math.floor((Date.now() - startTime) / 1000);

      document.getElementById("result").innerHTML =
        `${correctCount}もん せいかい。<br>${message}`;
      document.getElementById("timer").textContent = `かかったじかん・・・${timeTaken}びょう`;
      updateProgress(); // 最後に100%へ
    }

    generateQuestion();
  </script>
</body>
</html>
