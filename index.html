<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>足し算ゲーム</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background: #f0f8ff;
      padding: 20px;
    }
    #question {
      font-size: 80px;
      margin: 40px 0 10px;
    }
    .dots {
      font-size: 24px;
      line-height: 1.2;
      margin: 4px 0;
      text-align: left;
      white-space: pre-wrap;
    }
    #choices button {
      font-size: 32px;
      margin: 10px;
      padding: 20px 40px;
      cursor: pointer;
      background-color: white;
      border: 2px solid #ccc;
      border-radius: 10px;
      transition: background-color 0.3s;
    }
    #result {
      font-size: 36px;
      margin-top: 20px;
    }
    #progress {
      width: 100%;
      height: 30px;
      background: #eee;
      border-radius: 15px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    #progress-bar {
      height: 100%;
      background: #4caf50;
      width: 0%;
      transition: width 0.3s;
    }
  </style>
</head>
<body>

<h1>たしざんゲーム</h1>
<div id="progress"><div id="progress-bar"></div></div>

<div id="questionArea">
  <div id="question">1＋2＝？</div>
  <div class="dots" id="dotsA"></div>
  <div class="dots" id="dotsB"></div>
</div>

<div id="choices"></div>
<div id="result"></div>

<audio id="correctSound" src="correct.mp3"></audio>

<script>
  let questionCount = 0;
  let correctCount = 0;

  const question = document.getElementById("question");
  const dotsA = document.getElementById("dotsA");
  const dotsB = document.getElementById("dotsB");
  const choices = document.getElementById("choices");
  const result = document.getElementById("result");
  const progressBar = document.getElementById("progress-bar");
  const correctSound = document.getElementById("correctSound");

  function generateDots(n) {
    let dots = "【" + n + "】 ";
    for (let i = 1; i <= n; i++) {
      dots += "●";
      if (i % 5 === 0 && i !== n) dots += " ";
    }
    return dots;
  }

  function newQuestion() {
    if (questionCount >= 10) {
      showFinalResult();
      return;
    }

    result.textContent = "";
    choices.innerHTML = "";
    questionCount++;
    updateProgress();

    const a = Math.floor(Math.random() * 9) + 1;
    const b = Math.floor(Math.random() * 9) + 1;
    const answer = a + b;

    question.innerHTML = `${a} ＋ ${b} ＝ ?`;
    dotsA.textContent = generateDots(a);
    dotsB.textContent = generateDots(b);

    const answers = new Set([answer]);
    while (answers.size < 4) {
      answers.add(Math.floor(Math.random() * 17) + 1);
    }
    const shuffled = Array.from(answers).sort(() => Math.random() - 0.5);

    shuffled.forEach(num => {
      const btn = document.createElement("button");
      btn.textContent = num;
      btn.onclick = () => handleAnswer(num, answer, btn);
      choices.appendChild(btn);
    });
  }

  function handleAnswer(selected, correct, selectedButton) {
    const buttons = document.querySelectorAll("#choices button");
    buttons.forEach(btn => btn.disabled = true);

    const correctButton = Array.from(buttons).find(btn => parseInt(btn.textContent) === correct);

    if (selected === correct) {
      correctCount++;
      correctSound.currentTime = 0;
      correctSound.play();
      result.textContent = "せいかい！";
      correctButton.style.backgroundColor = "#a8e6a2";
      setTimeout(newQuestion, 500);
    } else {
      result.textContent = `ざんねん、せいかいは ${correct} です。`;
      selectedButton.style.backgroundColor = "#f8b6c4";
      correctButton.style.backgroundColor = "#a8e6a2";
      setTimeout(newQuestion, 3000);
    }
  }

  function updateProgress() {
    progressBar.style.width = `${(questionCount / 10) * 100}%`;
  }

  function showFinalResult() {
    question.textContent = "";
    dotsA.textContent = "";
    dotsB.textContent = "";
    choices.innerHTML = "";
    let message = "";

    if (correctCount <= 5) {
      mes
