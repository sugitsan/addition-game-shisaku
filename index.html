<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>たしざんゲーム</title>
  <style>
    body {
      text-align: center;
      font-size: 2em;
      font-family: sans-serif;
    }
    .dots {
      font-size: 1em;
      color: gray;
    }
    .choices button {
      font-size: 1.5em;
      margin: 10px;
      padding: 10px 20px;
    }
    .correct {
      background-color: lightgreen;
    }
    .wrong {
      background-color: lightcoral;
    }
    .highlight {
      background-color: #ffc0cb; /* 薄いピンク */
    }
  </style>
</head>
<body>
  <h1>たしざんゲーム</h1>
  <div id="problem">
    <div id="a"></div>
    <div class="dots" id="dotsA"></div>
    <div>＋</div>
    <div id="b"></div>
    <div class="dots" id="dotsB"></div>
    <div>＝<span id="answerPlaceholder">？</span></div>
  </div>
  <div class="choices" id="choices"></div>
  <div id="result"></div>

  <script>
    let correctAnswer = 0;
    let questionCount = 0;
    let correctCount = 0;

    function getRandomNumber() {
      return Math.floor(Math.random() * 9) + 1;
    }

    function renderDots(number) {
      return '●'.repeat(number);
    }

    function newQuestion() {
      document.getElementById('result').textContent = "";
      document.getElementById('answerPlaceholder').textContent = "？";

      const a = getRandomNumber();
      const b = getRandomNumber();
      correctAnswer = a + b;

      document.getElementById('a').textContent = a;
      document.getElementById('b').textContent = b;
      document.getElementById('dotsA').textContent = renderDots(a);
      document.getElementById('dotsB').textContent = renderDots(b);

      const answers = [correctAnswer];
      while (answers.length < 4) {
        const wrong = correctAnswer + Math.floor(Math.random() * 5) - 2;
        if (wrong > 0 && !answers.includes(wrong)) {
          answers.push(wrong);
        }
      }

      answers.sort(() => Math.random() - 0.5);

      const choices = document.getElementById('choices');
      choices.innerHTML = "";
      answers.forEach(ans => {
        const btn = document.createElement('button');
        btn.textContent = ans;
        btn.onclick = () => checkAnswer(ans, btn);
        choices.appendChild(btn);
      });
    }

    function checkAnswer(selected, button) {
      questionCount++;
      const buttons = document.querySelectorAll("#choices button");
      const correctButton = Array.from(buttons).find(b => Number(b.textContent) === correctAnswer);

      if (selected === correctAnswer) {
        correctCount++;
        button.classList.add("correct");
      } else {
        button.classList.add("wrong");
        correctButton.classList.add("highlight");
      }

      document.getElementById("answerPlaceholder").textContent = correctAnswer;

      setTimeout(() => {
        if (questionCount >= 10) {
          let message = `${correctCount}もん せいかい。`;
          if (correctCount <= 5) {
            message += " つぎも　がんばろう！";
          } else if (correctCount <= 8) {
            message += " なかなか　やりますね！";
          } else if (correctCount === 9) {
            message += " おしい、あと１もんでパーフェクト！";
          } else {
            message += " すばらしい！かんぺきです！！";
          }
          document.getElementById('problem').style.display = 'none';
          document.getElementById('choices').style.display = 'none';
          document.getElementById('result').textContent = message;
        } else {
          newQuestion();
        }
      }, 1000);
    }

    newQuestion();
  </script>
</body>
</html>

